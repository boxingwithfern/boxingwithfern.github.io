<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sport Events</title>
  
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

  <style>
    .cart-icon {
      position: relative;
    }
    .cart-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background-color: red;
      color: white;
      border-radius: 50%;
      font-size: 0.75rem;
      padding: 2px 6px;
    }
  </style>

</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-bold" href="#">Sport Events</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
        data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" href="#" onclick="navigateTo('first')">Browse Events</a></li>
          <li class="nav-item"><a class="nav-link" href="createevent.html">Create Event</a></li>

          <li class="nav-item me-3">
            <a class="nav-link position-relative cart-icon" href="#" onclick="navigateTo('third')">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                   fill="currentColor" class="bi bi-cart" viewBox="0 0 16 16">
                <path d="M0 1.5A.5.5 0 0 1 .5 1h1a.5.5 0 0 1 
                         .485.379L2.89 5H14.5a.5.5 0 0 1 
                         .49.598l-1.5 7A.5.5 0 0 1 13 
                         13H4a.5.5 0 0 1-.49-.402L1.61 
                         2H.5a.5.5 0 0 1-.5-.5zM3.14 
                         6l1.25 5h8.223l1.25-5H3.14zM5.5 
                         14a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm5 
                         0a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/>
              </svg>
              <span class="cart-badge" id="cartItemCount">0</span> <!-- Change this dynamically -->
            </a>
          </li>          

          <li class="nav-item"><a class="nav-link" href="login.html">Sign In</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Hero Section -->
  <section class="py-5 text-center bg-primary text-white">
    <div class="container">
      <h1 class="display-5 fw-bold">Discover Events Near You</h1>
      <p class="lead">Attend, host, and explore amazing events.</p>
      <a href="#" class="btn btn-light btn-lg" id="adminAddEventButton">Create an Event</a>
    </div>
  </section>

  <!-- Events Section -->
  <section class="py-5" id="first">
    <div class="container">
      <h2 class="mb-4">Upcoming Events</h2>
      <div class="row g-4" id="eventListContainer">

	<p class="text-gray-500 text-center col-span-full">No events available. Try adding a sample event!</p>

      </div>

      </div>

  </section>


  <!-- Events Section -->
  <section class="py-5" style="display: none;" id="second">
    <div class="container">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">Select Event</h2>

            <div id="eventDetailContent" class="flex-grow scroll-y-auto space-y-4">
                <!-- Order review items will be loaded here -->
            </div>

    </div>
  </section>  


    <!-- Events Section -->
  <section class="py-5" style="display: none;" id="third">
    <div class="container">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">Your Shopping Cart</h2>
            <div id="cartItemsContainer" class="flex-grow scroll-y-auto space-y-4">
                <!-- Cart items will be loaded here -->
                <p class="text-gray-500 text-center">Your cart is empty.</p>
            </div>

              <div class="row g-3 mb-3">
                  <div class="col-md-6">
                    <p class="text-xl font-semibold text-gray-800">Total: <span id="cartTotal" class="text-purple-600">$0.00</span></p>
                  </div>                
                  <div class="col-md-6">
                    <button id="proceedToCheckoutButton" class="btn btn-primary" onclick="navigateTo('fourth')">
                        Proceed to Checkout
                    </button>
                  </div>
              </div>            

    </div>            
  </section>

  <section class="py-5" style="display: none;" id="fourth">
    <div class="container">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">Checkout: Review Your Order</h2>

            <div id="checkoutReviewItems" class="flex-grow scroll-y-auto space-y-4">
                <!-- Order review items will be loaded here -->
            </div>

              <div class="row g-3 mb-3">
                  <div class="col-md-6">
                    <!--<p class="text-xl font-semibold text-gray-800">Total: <span id="cartTotal" class="text-purple-600">$0.00</span></p>-->
                    <p class="text-xl font-semibold text-gray-800">Total: <span id="checkoutReviewTotal" class="text-purple-600">$0.00</span></p>
                  </div>                
                  <div class="col-md-6">
                    <button id="proceedToCheckoutButton" class="btn btn-primary" onclick="navigateTo('fifth')">
                        Continue to Payment
                    </button>
                  </div>
              </div>            

    </div>            
  </section>  

        <!-- Checkout Payment Page -->
        <section id="fifth" class="page-section flex-grow p-4 bg-white rounded-lg shadow-lg flex flex-col" style="display: none;">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">Checkout: Payment Details</h2>
            <form id="paymentForm">
              <div class="mb-3">
                <label for="cardNumber" class="form-label">Card Number</label>
                <input type="text" id="cardNumber" class="form-control" placeholder="•••• •••• •••• ••••" required maxlength="19">
              </div>              

                <div class="row g-3 mb-3">
                  <div class="col-md-6">
                    <label for="expiryDate" class="form-label">Expiry Date (MM/YY)</label>
                    <input type="text" id="expiryDate" class="form-control" placeholder="MM/YY" required maxlength="5">
                  </div>
                  <div class="col-md-6">
                    <label for="cvv" class="form-label">CVV</label>
                    <input type="text" id="cvv" class="form-control" placeholder="•••" required maxlength="4">
                  </div>
                </div>  
                
                <div class="mb-3">
                    <label for="cardName" class="form-label">Name on Card</label>
                    <input type="text" id="cardName" class="form-control" placeholder="John Doe" required>                  
                </div>                


              <!-- Submit -->
              <div class="d-grid">
                <button type="submit" class="btn btn-success btn-lg">Place Order</button>
              </div>                
            </form>
        </section>  

  <!-- Footer -->
  <footer class="bg-light text-center py-4 mt-5 border-top">
    <div class="container">
      <p class="mb-0">&copy; 2025 Boxing with Fern. All rights reserved.</p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module">

        let userId = null;
        let events = [];
        let cart = { items: [] }; // { items: [{ eventId, quantity, price, title, imageUrl }] }
        let selectedEvent = null;
        let currentPage = 'eventList'; // Initial page

        const adminAddEventButton = document.getElementById('adminAddEventButton');
        const eventListContainer = document.getElementById('eventListContainer');
        const eventDetailContent = document.getElementById('eventDetailContent');
        const cartItemCountSpan = document.getElementById('cartItemCount');
        const cartItemsContainer = document.getElementById('cartItemsContainer');
        const cartTotalSpan = document.getElementById('cartTotal');
        const checkoutReviewItems = document.getElementById('checkoutReviewItems');
        const checkoutReviewTotalSpan = document.getElementById('checkoutReviewTotal');

        async function addSampleEvent() {

                        document.getElementById("first").style.display = "";
                        document.getElementById("second").style.display = "none";
                        document.getElementById("third").style.display = "none"; 

            if (events.length === 0) {

            const sampleEvent = {
                id: 100,
                title: "Grand Tech Summit 2025",
                description: "Join us for the most anticipated technology summit of 2025! Featuring leading experts, groundbreaking innovations, and unparalleled networking opportunities. Explore the future of AI, blockchain, cybersecurity, and more. Don't miss out on this transformative experience!",
                date: "2025-09-15",
                time: "09:00 AM",
                location: "London Convention Center, London",
                price: 199.99,
                availableTickets: 500,
                imageUrl: ""
            };
            events.push(sampleEvent);

            }
            else {


            const sampleEvent = {
                id: 100 + events.length,
                title: "Tech Plaza",
                description: "Join us for the most anticipated technology summit of 2025! Featuring leading experts, groundbreaking innovations, and unparalleled networking opportunities. Explore the future of AI, blockchain, cybersecurity, and more. Don't miss out on this transformative experience!",
                date: "2025-09-15",
                time: "09:00 AM",
                location: "Medway",
                price: 199.99,
                availableTickets: 500,
                imageUrl: ""
            };
            events.push(sampleEvent);

            }

            //console.log(events);
            //window.showMessageModal("Success", "Sample event added successfully!");
            //fetchAndRenderEvents();  

	    eventListContainer.innerHTML = ''; 
            

            if (events.length === 0) {
                eventListContainer.innerHTML = '<p class="text-gray-500 text-center col-span-full">No events available. Try adding a sample event!</p>';
                return;
            }

            events.forEach(event => {
                const eventCard = `
                    <div class="col-md-4">
                      <div class="card h-100 shadow-sm">
                        <img src="https://via.placeholder.com/400x200" class="card-img-top" alt="Event Image">
                        <div class="card-body">
                          <h5 class="card-title">${event.title}</h5>
                          <p class="card-text">
                            <strong>Date:</strong>${new Date(event.date).toLocaleDateString()} at ${event.time}<br />
                            <strong>Location:</strong>${event.location}
                          </p>
                          <a href="#" class="btn btn-primary" onclick="window.navigateTo('second', ${event.id})">Get Tickets</a>
                        </div>
                      </div>
                    </div>
                `;
                eventListContainer.insertAdjacentHTML('beforeend', eventCard);
            });            
            

        }        
        adminAddEventButton.addEventListener('click', addSampleEvent);

        function updateCartIconCount() {
            const totalItems = cart.items.reduce((sum, item) => sum + item.quantity, 0);
            //alert(totalItems);
            if (totalItems > 0) {
                cartItemCountSpan.textContent = totalItems;
                //cartItemCountSpan.classList.remove('hidden');
                cartItemCountSpan.style.display = "";
            } else {
                //cartItemCountSpan.classList.add('hidden');
                cartItemCountSpan.style.display = "none";
            }
        }       
        
        async function addToCart() {
/*            
            if (!userId) {
                window.showMessageModal("Error", "User not authenticated. Please refresh the page.");
                return;
            }
*/
            const quantityInput = document.getElementById('ticketQuantity');
            const quantity = parseInt(quantityInput.value);

            if (isNaN(quantity) || quantity <= 0) {
                window.showMessageModal("Invalid Quantity", "Please enter a valid quantity.");
                return;
            }
            if (quantity > selectedEvent.availableTickets) {
                window.showMessageModal("Not Enough Tickets", `Only ${selectedEvent.availableTickets} tickets available.`);
                return;
            }

            const existingItemIndex = cart.items.findIndex(item => item.eventId === selectedEvent.id);

            if (existingItemIndex > -1) {
                // Update quantity if item already in cart
                cart.items[existingItemIndex].quantity += quantity;
            } else {
                // Add new item to cart
                cart.items.push({
                    eventId: selectedEvent.id,
                    title: selectedEvent.title,
                    price: selectedEvent.price,
                    quantity: quantity,
                    imageUrl: selectedEvent.imageUrl
                });
            }
            updateCartIconCount();
                
        }     
        //document.getElementById('addToCartButton').addEventListener('click', addToCart);   
        
        /**
         * Generates a UUID.
         * @returns {string} A unique ID.
         */
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0,
                    v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }
        
        /**
         * Switches the active page/view in the single-page application.
         * @param {string} pageName - The ID of the section to show (e.g., 'eventList', 'eventDetail').
         * @param {any} [data] - Optional data to pass to the next page (e.g., event ID).
         */
        window.navigateTo = function(pageName, data = null) { // Made global
            // Hide all page sections
/*            
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });
*/
            // Show the requested page section
            //alert(pageName);
            const targetPage = document.getElementById(`${pageName}`);
            if (targetPage) {
                targetPage.classList.add('active');
                currentPage = pageName; // Update current page state

                // Perform page-specific rendering
                switch (pageName) {
                    case 'first':
                        document.getElementById("first").style.display = "";
                        document.getElementById("second").style.display = "none";
                        document.getElementById("third").style.display = "none";    
                        document.getElementById("fourth").style.display = "none"; 
                        document.getElementById("fifth").style.display = "none";    
                                        
                        break;  
                    case 'second':
//alert(data);
                        //selectedEvent = events[0];
                        console.log(data);
                        selectedEvent = events.find(event => event.id === data);
                        console.log(selectedEvent.id);
                        document.getElementById("second").style.display = "";
                        document.getElementById("first").style.display = "none"; 
                        document.getElementById("third").style.display = "none";  
                        document.getElementById("fourth").style.display = "none";
                        document.getElementById("fifth").style.display = "none";
                        renderEventDetail();  
                        break;  
                    case 'third':
                        //selectedEvent = events[0];
                        document.getElementById("third").style.display = "";
                        document.getElementById("first").style.display = "none"; 
                        document.getElementById("second").style.display = "none";  
                        document.getElementById("fourth").style.display = "none";
                        document.getElementById("fifth").style.display = "none";
                        renderCart();
                        break;   
                    case 'fourth':
                        //selectedEvent = events[0];
                        document.getElementById("fourth").style.display = "";
                        document.getElementById("first").style.display = "none"; 
                        document.getElementById("second").style.display = "none";  
                        document.getElementById("third").style.display = "none";
                        renderCheckoutReview();
                        break;   
                    case 'fifth':
                        //selectedEvent = events[0];
                        document.getElementById("fifth").style.display = "";
                        document.getElementById("first").style.display = "none"; 
                        document.getElementById("second").style.display = "none";  
                        document.getElementById("third").style.display = "none";
                        document.getElementById("fourth").style.display = "none";
                        renderCheckoutReview();
                        break;                                                                                                           
                    case 'eventList':
                        document.getElementById("eventListPage").style.display = "";
                        document.getElementById("eventDetailPage").style.display = "none";   
                        document.getElementById("cartPage").style.display = "none";    
                        document.getElementById("checkoutReviewPage").style.display = "none";                        
                        document.getElementById("checkoutPaymentPage").style.display = "none";                        
                        renderEvents();
                        break;
                    case 'eventDetail':
                        if (data) {
                            console.log(data);
                            //selectedEvent = events.find(event => event.id === data);
                            selectedEvent = events[0];
                            console.log(events[0]);
                            console.log(document.getElementById("eventListPage").style.display);
                            document.getElementById("eventListPage").style.display = "none";
                            document.getElementById("eventDetailPage").style.display = "";
                            renderEventDetail();
                        } else {
                            // If no data, navigate back to list or show error
                            navigateTo('eventList');
                        }
                        break;
                    case 'cart':
                        
                        document.getElementById("eventListPage").style.display = "none";
                        document.getElementById("eventDetailPage").style.display = "none";   
                        document.getElementById("cartPage").style.display = "";     
                        document.getElementById("checkoutReviewPage").style.display = "none";                        
                        document.getElementById("checkoutPaymentPage").style.display = "none";                                             
                        renderCart();
                        break;
                    case 'checkoutReview':

                        document.getElementById("eventListPage").style.display = "none";
                        document.getElementById("eventDetailPage").style.display = "none";   
                        document.getElementById("cartPage").style.display = "none";    
                        document.getElementById("checkoutReviewPage").style.display = ""; 
                        document.getElementById("checkoutPaymentPage").style.display = "none";                      
                        renderCheckoutReview();
                        break;
                    case 'checkoutPayment':
                        // No specific rendering for this, just showing form
                        
                        document.getElementById("eventListPage").style.display = "none";
                        document.getElementById("eventDetailPage").style.display = "none";   
                        document.getElementById("cartPage").style.display = "none";    
                        document.getElementById("checkoutReviewPage").style.display = "none";                        
                        document.getElementById("checkoutPaymentPage").style.display = "";
                        break;
                    case 'checkoutConfirmation':
                        // Data here should be order details if available
                        break;
                }
                // Scroll to top of the main content area
                document.querySelector('main').scrollTo(0, 0);
            } else {
                console.error(`Page section with ID '${pageName}Page' not found.`);
            }
            //lucide.createIcons(); // Re-render Lucide icons on page change
        }  

        /**
         * Renders the detailed view of the selected event.
         */
        function renderEventDetail() {
            //if (currentPage !== 'eventDetail' || !selectedEvent) return;
            eventDetailContent.innerHTML = ''; // Clear previous content

            const detailHtml = `
                <div class="lg:w-1/2 flex justify-center items-center">
                    <img src="${selectedEvent.imageUrl || 'https://placehold.co/600x400/a78bfa/ffffff?text=Event+Image'}" alt="${selectedEvent.title}" class="rounded-lg shadow-xl w-full max-h-96 object-cover">
                </div>
                <div class="lg:w-1/2 p-4">
                    <h2 class="text-4xl font-bold text-gray-800 mb-4">${selectedEvent.title}</h2>
                    <p class="text-gray-700 mb-6 leading-relaxed">${selectedEvent.description}</p>
                    <div class="space-y-3 text-lg text-gray-700 mb-8">
                        <p class="flex items-center"><i data-lucide="calendar" class="w-5 h-5 mr-3 text-purple-600"></i> Date: <span class="font-semibold ml-2">${new Date(selectedEvent.date).toLocaleDateString()}</span></p>
                        <p class="flex items-center"><i data-lucide="clock" class="w-5 h-5 mr-3 text-purple-600"></i> Time: <span class="font-semibold ml-2">${selectedEvent.time}</span></p>
                        <p class="flex items-center"><i data-lucide="map-pin" class="w-5 h-5 mr-3 text-purple-600"></i> Location: <span class="font-semibold ml-2">${selectedEvent.location}</span></p>
                        <p class="flex items-center"><i data-lucide="ticket" class="w-5 h-5 mr-3 text-purple-600"></i> Available Tickets: <span class="font-semibold ml-2">${selectedEvent.availableTickets}</span></p>
                        <p class="flex items-center"><i data-lucide="dollar-sign" class="w-5 h-5 mr-3 text-purple-600"></i> Price: <span class="font-bold text-green-600 text-2xl ml-2">$${selectedEvent.price.toFixed(2)}</span></p>
                    </div>
                    <div class="flex items-center space-x-4 mt-6">
                        <label for="ticketQuantity" class="text-lg font-semibold text-gray-800">Quantity:</label>
                        <input type="number" id="ticketQuantity" value="1" min="1" max="${selectedEvent.availableTickets}" class="w-24 p-2 border border-gray-300 rounded-md text-center focus:ring-purple-500 focus:border-purple-500 transition duration-300">
                        <button id="addToCartButton" class="btn btn-primary">
                            Add to Cart
                        </button>
                    </div>
                </div>
            `;
            eventDetailContent.insertAdjacentHTML('beforeend', detailHtml);
            //lucide.createIcons();

            document.getElementById('addToCartButton').addEventListener('click', addToCart);
        }        
        
        /**
         * Renders the shopping cart page with current items.
         */
        function renderCart() {
            //if (currentPage !== 'cart') return;
            cartItemsContainer.innerHTML = ''; // Clear previous content
            let total = 0;

            if (cart.items.length === 0) {
                cartItemsContainer.innerHTML = '<p class="text-gray-500 text-center col-span-full">Your cart is empty.</p>';
                proceedToCheckoutButton.disabled = true;
            } else {
                cart.items.forEach(item => {
                    total += item.price * item.quantity;
                    const cartItemHtml = `
                        <div class="flex flex-col sm:flex-row items-center bg-gray-50 rounded-lg p-4 shadow-sm">
                            <img src="${item.imageUrl || 'https://placehold.co/100x70/a78bfa/ffffff?text=Ticket'}" alt="${item.title}" class="w-24 h-16 object-cover rounded-md mb-3 sm:mb-0 sm:mr-4">
                            <div class="flex-grow">
                                <h3 class="text-lg font-semibold text-gray-900">${item.title}</h3>
                                <p class="text-gray-600">$${item.price.toFixed(2)} per ticket</p>
                            </div>
  	                      <div class="row">                
                            <div class="col-lg-2">
                                      <div class="input-group">
                                        <span class="input-group-btn">
                                            <button type="button" class="quantity-left-minus btn btn-light btn-number"  data-type="minus" data-field="">
                                              <span class="bi bi-dash"></span>
                                            </button>
                                        </span>
                                        <input type="text" id="qty-${item.eventId}" name="qty-${item.eventId}" class="form-control input-number" value="${item.quantity}" min="1" max="100" readonly>                                        
                                        <span class="input-group-btn">
                                            <button type="button" class="quantity-right-plus btn btn-light btn-number" data-type="plus" data-field="">
                                                <span class="bi bi-plus"></span>
                                            </button>
                                        </span>
                                        <span class="input-group-btn">
                                            <button type="button" class="quantity-left-minus btn btn-danger btn-number"  data-type="minus" data-field="">
                                              <span class="bi bi-trash"></span>
                                            </button>
                                        </span>                                    
                                    </div>
                                    
                            </div>
	                        </div>
                        </div>
                        
                    `;
                    cartItemsContainer.insertAdjacentHTML('beforeend', cartItemHtml);
                });
                proceedToCheckoutButton.disabled = false;
            }
            //alert(total);
            cartTotalSpan.textContent = `$${total.toFixed(2)}`;
            //lucide.createIcons();

            // Add event listeners for quantity buttons
/*            
            document.querySelectorAll('.quantity-button').forEach(button => {
                button.addEventListener('click', handleCartQuantityChange);
            });
*/            
        }   
        
        
        /**
         * Renders the order review page before payment.
         */
        function renderCheckoutReview() {
            //if (currentPage !== 'checkoutReview') return;
            checkoutReviewItems.innerHTML = '';
            let total = 0;

            if (cart.items.length === 0) {
                checkoutReviewItems.innerHTML = '<p class="text-gray-500 text-center col-span-full">Your cart is empty. Please add items to proceed.</p>';
                // Optionally redirect back to cart if empty
                setTimeout(() => window.navigateTo('cart'), 1000);
                return;
            }

            cart.items.forEach(item => {
                total += item.price * item.quantity;
                const reviewItemHtml = `
                    <div class="flex items-center bg-gray-50 rounded-lg p-4 shadow-sm">
                        <img src="${item.imageUrl || 'https://placehold.co/80x50/a78bfa/ffffff?text=Ticket'}" alt="${item.title}" class="w-20 h-14 object-cover rounded-md mr-4">
                        <div class="flex-grow">
                            <h3 class="text-lg font-semibold text-gray-900">${item.title}</h3>
                            <p class="text-gray-600">${item.quantity} x $${item.price.toFixed(2)}</p>
                        </div>
                        <span class="text-lg font-bold text-purple-700">$${(item.price * item.quantity).toFixed(2)}</span>
                    </div>
                `;
                checkoutReviewItems.insertAdjacentHTML('beforeend', reviewItemHtml);
            });
            checkoutReviewTotalSpan.textContent = `$${total.toFixed(2)}`;
            //lucide.createIcons();
        }        

        // --- Initialization on Window Load ---
        window.onload = async function() {

            updateCartIconCount();
            
            //fetchAndRenderEvents();
            //fetchUserCart();
            window.navigateTo('eventList'); // Navigate to the event list on initial load
        };
  </script>
</body>
</html>
